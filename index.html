<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Healthy Planet Â· Image Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #0d6e2f;
    --green2: #1a9c45;
    --orange: #ff6b00;
    --orange2: #ff9500;
    --yellow: #ffd000;
    --red: #ff2d55;
    --bg: #0a0f0a;
    --card: #111811;
    --card2: #162016;
    --border: rgba(255,255,255,0.07);
    --text: #f0f8f0;
    --muted: #7a9a7a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 10% 10%, rgba(13,110,47,0.25) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 90% 80%, rgba(255,107,0,0.15) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 50% 50%, rgba(255,208,0,0.04) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
    animation: bgPulse 8s ease-in-out infinite alternate;
  }

  @keyframes bgPulse { 0% { opacity: 0.6; } 100% { opacity: 1; } }

  .particles { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
  .particle { position: absolute; border-radius: 50%; animation: float linear infinite; opacity: 0; }

  @keyframes float {
    0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
    10% { opacity: 1; } 90% { opacity: 1; }
    100% { transform: translateY(-10vh) rotate(720deg); opacity: 0; }
  }

  header {
    position: relative; z-index: 10; padding: 0 40px;
    display: flex; align-items: center; justify-content: space-between;
    height: 80px; border-bottom: 1px solid var(--border);
    background: rgba(10,15,10,0.8); backdrop-filter: blur(20px);
    animation: slideDown 0.6s ease both;
  }

  @keyframes slideDown { from { transform: translateY(-80px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

  .logo-area { display: flex; align-items: center; gap: 16px; }

  .logo-badge {
    width: 46px; height: 46px;
    background: linear-gradient(135deg, var(--green), var(--green2));
    border-radius: 12px; display: flex; align-items: center; justify-content: center;
    font-size: 22px; animation: glowPulse 3s ease-in-out infinite;
  }

  @keyframes glowPulse {
    0%, 100% { box-shadow: 0 0 20px rgba(26,156,69,0.4); }
    50% { box-shadow: 0 0 40px rgba(26,156,69,0.7), 0 0 80px rgba(26,156,69,0.2); }
  }

  .logo-text {
    font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; letter-spacing: 3px;
    background: linear-gradient(90deg, var(--green2), var(--yellow));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }

  .logo-sub { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 2px; margin-top: -4px; }

  .header-badge {
    background: linear-gradient(135deg, var(--orange), var(--orange2));
    padding: 6px 16px; border-radius: 100px; font-size: 11px;
    font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
    animation: badgePop 0.6s 0.4s ease both;
  }

  @keyframes badgePop { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .hero { position: relative; z-index: 10; padding: 50px 40px 30px; animation: fadeUp 0.7s 0.2s ease both; }

  @keyframes fadeUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

  .hero h1 { font-family: 'Bebas Neue', sans-serif; font-size: clamp(3rem, 7vw, 6rem); line-height: 0.95; letter-spacing: 2px; }
  .hero h1 span.g { color: var(--green2); }
  .hero h1 span.o {
    background: linear-gradient(90deg, var(--orange), var(--yellow));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }

  .hero-sub { margin-top: 14px; color: var(--muted); font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 3px; }

  .stats-bar { position: relative; z-index: 10; display: flex; gap: 20px; padding: 0 40px 30px; animation: fadeUp 0.7s 0.3s ease both; flex-wrap: wrap; }

  .stat { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px 24px; display: flex; align-items: center; gap: 12px; transition: transform 0.3s, border-color 0.3s; }
  .stat:hover { transform: translateY(-3px); border-color: rgba(26,156,69,0.3); }
  .stat-icon { font-size: 24px; }
  .stat-val { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; color: var(--green2); line-height: 1; }
  .stat-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }

  .main { position: relative; z-index: 10; padding: 0 40px 60px; animation: fadeUp 0.7s 0.4s ease both; }

  .drop-zone {
    border: 2px dashed rgba(26,156,69,0.4); border-radius: 24px; padding: 50px;
    text-align: center; background: var(--card); cursor: pointer;
    transition: all 0.3s; margin-bottom: 30px; position: relative; overflow: hidden;
  }

  .drop-zone::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at center, rgba(26,156,69,0.05) 0%, transparent 70%); opacity: 0; transition: opacity 0.3s; }
  .drop-zone:hover::before, .drop-zone.drag-over::before { opacity: 1; }
  .drop-zone:hover, .drop-zone.drag-over { border-color: var(--green2); transform: scale(1.01); box-shadow: 0 0 60px rgba(26,156,69,0.1); }

  .drop-icon { font-size: 3.5rem; margin-bottom: 16px; display: block; animation: bounce 2s ease-in-out infinite; }

  @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

  .drop-title { font-size: 1.2rem; font-weight: 800; color: var(--text); margin-bottom: 6px; }
  .drop-sub { color: var(--muted); font-size: 13px; font-weight: 600; }
  .upload-btn-wrap { margin-top: 20px; }

  .controls { display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; align-items: center; }

  .search-wrap { flex: 1; min-width: 220px; position: relative; }
  .search-wrap::before { content: 'ğŸ”'; position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 14px; pointer-events: none; }

  .search-box { width: 100%; background: var(--card); border: 1px solid var(--border); border-radius: 100px; padding: 12px 20px 12px 44px; color: var(--text); font-family: 'Nunito', sans-serif; font-size: 14px; font-weight: 600; outline: none; transition: border-color 0.3s, box-shadow 0.3s; }
  .search-box:focus { border-color: rgba(26,156,69,0.5); box-shadow: 0 0 0 3px rgba(26,156,69,0.1); }
  .search-box::placeholder { color: var(--muted); }

  .btn { border: none; padding: 11px 22px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 12px; border-radius: 100px; cursor: pointer; transition: all 0.25s; text-transform: uppercase; letter-spacing: 1px; }
  .btn:active { transform: scale(0.96); }

  .btn-green { background: linear-gradient(135deg, var(--green), var(--green2)); color: white; box-shadow: 0 4px 20px rgba(26,156,69,0.3); }
  .btn-green:hover { box-shadow: 0 6px 30px rgba(26,156,69,0.5); transform: translateY(-2px); }

  .btn-orange { background: linear-gradient(135deg, var(--orange), var(--orange2)); color: white; box-shadow: 0 4px 20px rgba(255,107,0,0.3); }
  .btn-orange:hover { box-shadow: 0 6px 30px rgba(255,107,0,0.5); transform: translateY(-2px); }

  .btn-yellow { background: linear-gradient(135deg, #b8860b, var(--yellow)); color: #0a0f0a; box-shadow: 0 4px 20px rgba(255,208,0,0.2); }
  .btn-yellow:hover { box-shadow: 0 6px 30px rgba(255,208,0,0.4); transform: translateY(-2px); }

  .btn-red { background: linear-gradient(135deg, #c0392b, var(--red)); color: white; box-shadow: 0 4px 20px rgba(255,45,85,0.3); margin-left: auto; }
  .btn-red:hover { box-shadow: 0 6px 30px rgba(255,45,85,0.5); transform: translateY(-2px); }

  .btn-ghost { background: var(--card2); border: 1px solid var(--border); color: var(--text); font-size: 11px; padding: 6px 14px; border-radius: 8px; }
  .btn-ghost:hover { border-color: var(--green2); color: var(--green2); }

  input[type="file"] { display: none; }

  .table-wrap { background: var(--card); border: 1px solid var(--border); border-radius: 24px; overflow: hidden; }
  .table-header { padding: 20px 28px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; background: var(--card2); }
  .table-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 2px; color: var(--green2); }
  .table-count { background: rgba(26,156,69,0.15); border: 1px solid rgba(26,156,69,0.3); color: var(--green2); padding: 4px 14px; border-radius: 100px; font-size: 12px; font-weight: 800; }

  table { width: 100%; border-collapse: collapse; }
  thead th { padding: 14px 20px; text-align: left; font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); font-weight: 800; background: rgba(255,255,255,0.02); border-bottom: 1px solid var(--border); }

  tbody tr { border-bottom: 1px solid var(--border); transition: background 0.2s; animation: rowIn 0.4s ease both; }
  @keyframes rowIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
  tbody tr:hover { background: rgba(26,156,69,0.04); }
  tbody tr:last-child { border-bottom: none; }
  td { padding: 14px 20px; font-size: 13px; color: var(--text); vertical-align: middle; }

  .num-cell { color: var(--muted); font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; width: 50px; }
  .preview-cell { width: 80px; }

  .img-thumb { width: 56px; height: 56px; object-fit: contain; border-radius: 10px; border: 1px solid var(--border); background: var(--card2); transition: transform 0.3s, box-shadow 0.3s; cursor: zoom-in; }
  .img-thumb:hover { transform: scale(1.1); box-shadow: 0 8px 30px rgba(0,0,0,0.4); }

  .file-name { font-weight: 700; margin-bottom: 4px; color: var(--text); word-break: break-all; }
  .file-url { font-size: 11px; color: var(--muted); word-break: break-all; font-family: monospace; }

  .action-cell { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

  .view-link { color: var(--orange); font-weight: 800; font-size: 12px; text-decoration: none; text-transform: uppercase; letter-spacing: 1px; transition: color 0.2s; }
  .view-link:hover { color: var(--orange2); }

  .del-btn { background: rgba(255,45,85,0.1); border: 1px solid rgba(255,45,85,0.2); color: var(--red); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: all 0.2s; }
  .del-btn:hover { background: rgba(255,45,85,0.25); transform: scale(1.1); }

  .empty-state { padding: 80px 20px; text-align: center; color: var(--muted); }
  .empty-icon { font-size: 4rem; margin-bottom: 16px; display: block; }
  .empty-title { font-size: 1.1rem; font-weight: 800; color: var(--text); margin-bottom: 8px; }

  .loading-state { padding: 80px 20px; text-align: center; color: var(--muted); }
  .spinner { width: 48px; height: 48px; border: 3px solid var(--border); border-top-color: var(--green2); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .progress-wrap { display: none; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 999; background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 16px 24px; min-width: 300px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
  .progress-label { font-size: 13px; font-weight: 700; margin-bottom: 10px; display: flex; justify-content: space-between; }
  .progress-bar { height: 6px; background: var(--border); border-radius: 100px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--green), var(--green2)); border-radius: 100px; transition: width 0.3s; width: 0%; }

  .toast { position: fixed; top: 100px; right: 30px; z-index: 9999; background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px 22px; font-size: 14px; font-weight: 700; box-shadow: 0 20px 60px rgba(0,0,0,0.4); transform: translateX(200px); opacity: 0; transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); display: flex; align-items: center; gap: 10px; max-width: 320px; }
  .toast.show { transform: translateX(0); opacity: 1; }
  .toast.success { border-left: 4px solid var(--green2); }
  .toast.error { border-left: 4px solid var(--red); }
  .toast.info { border-left: 4px solid var(--orange); }

  .lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
  .lightbox.open { display: flex; animation: fadeIn 0.2s ease; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .lightbox img { max-width: 90vw; max-height: 85vh; object-fit: contain; border-radius: 16px; box-shadow: 0 40px 100px rgba(0,0,0,0.6); animation: zoomIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
  @keyframes zoomIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  .lightbox-close { position: absolute; top: 24px; right: 30px; color: white; font-size: 1.5rem; cursor: pointer; background: rgba(255,255,255,0.1); border: none; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
  .lightbox-close:hover { background: rgba(255,255,255,0.2); }

  footer { position: relative; z-index: 10; text-align: center; padding: 30px; color: var(--muted); font-size: 12px; font-weight: 600; border-top: 1px solid var(--border); }
  footer span { color: var(--green2); }

  @media (max-width: 600px) {
    header { padding: 0 20px; }
    .hero, .stats-bar, .main { padding-left: 20px; padding-right: 20px; }
    .drop-zone { padding: 30px 20px; }
    .btn { padding: 9px 16px; font-size: 11px; }
  }
</style>
</head>
<body>

<div class="particles" id="particles"></div>

<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">âœ•</button>
  <img id="lightboxImg" src="" alt="">
</div>

<div class="toast" id="toast">
  <span id="toastIcon">âœ…</span>
  <span id="toastMsg">Done!</span>
</div>

<div class="progress-wrap" id="progressWrap">
  <div class="progress-label">
    <span id="progressLabel">Uploading...</span>
    <span id="progressPct">0%</span>
  </div>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
</div>

<header>
  <div class="logo-area">
    <div class="logo-badge">ğŸŒ¿</div>
    <div>
      <div class="logo-text">Healthy Planet</div>
      <div class="logo-sub">Image Manager</div>
    </div>
  </div>
  <div class="header-badge">ğŸ‡¨ğŸ‡¦ Canada</div>
</header>

<div class="hero">
  <h1><span class="g">IMAGE</span><br><span class="o">LIBRARY</span></h1>
  <div class="hero-sub">Marketing Department Â· Healthy Planet Canada</div>
</div>

<div class="stats-bar">
  <div class="stat">
    <div class="stat-icon">ğŸ–¼ï¸</div>
    <div><div class="stat-val" id="statCount">â€”</div><div class="stat-label">Total Images</div></div>
  </div>
  <div class="stat">
    <div class="stat-icon">â˜ï¸</div>
    <div><div class="stat-val">Azure</div><div class="stat-label">Blob Storage</div></div>
  </div>
  <div class="stat">
    <div class="stat-icon">ğŸ”’</div>
    <div><div class="stat-val">HTTPS</div><div class="stat-label">Secured</div></div>
  </div>
</div>

<div class="main">
  <div class="drop-zone" id="dropZone"
       onclick="document.getElementById('fileInput').click()"
       ondragover="handleDragOver(event)"
       ondragleave="handleDragLeave(event)"
       ondrop="handleDrop(event)">
    <span class="drop-icon">â˜ï¸</span>
    <div class="drop-title">Drop images here or click to upload</div>
    <div class="drop-sub">Supports JPG, PNG, GIF, WEBP, SVG</div>
    <div class="upload-btn-wrap">
      <button class="btn btn-green" onclick="event.stopPropagation(); document.getElementById('fileInput').click()">â¬†ï¸ Choose Files</button>
    </div>
    <input type="file" id="fileInput" multiple accept="image/*">
  </div>

  <div class="controls">
    <div class="search-wrap">
      <input class="search-box" id="searchInput" type="text" placeholder="Search images..." onkeyup="filterImages()">
    </div>
    <button class="btn btn-green"  onclick="exportData('txt')">ğŸ“„ TXT</button>
    <button class="btn btn-orange" onclick="exportData('csv')">ğŸ“Š CSV</button>
    <button class="btn btn-yellow" onclick="exportData('sql')">ğŸ—„ï¸ SQL</button>
    <button class="btn btn-orange" onclick="window.print()">ğŸ–¨ï¸ Print</button>
    <button class="btn btn-red"    onclick="deleteAllImages()">ğŸ—‘ï¸ Delete All</button>
  </div>

  <div class="table-wrap">
    <div class="table-header">
      <div class="table-title">ğŸ“ Image Library</div>
      <div class="table-count" id="tableCount">Loading...</div>
    </div>
    <table>
      <thead>
        <tr>
          <th class="num-cell">#</th>
          <th>Preview</th>
          <th>File Name & HTTPS URL</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="imageList">
        <tr><td colspan="4">
          <div class="loading-state">
            <div class="spinner"></div>
            <div>Connecting to Azure Blob Storage...</div>
          </div>
        </td></tr>
      </tbody>
    </table>
  </div>
</div>

<footer>Â© 2026 <span>Healthy Planet Canada</span> Â· Marketing Image Manager Â· Built with â¤ï¸</footer>

<script>
// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  CONFIG â€” ONLY CHANGE THESE 3 VALUES        â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_ACCOUNT = "hpcanadanavimages";
const CONTAINER       = "images";
const SAS_TOKEN       = "se=2030-12-31&sp=rcwdl&spr=https&sv=2026-02-06&sr=c&sig=Vbw9RcaJVq%2BTCTeEeBYxhkXzIeyLg%2BHzzgt8LDg%2BTjs%3D";

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ALL URLS ARE HTTPS â€” NO HTTP ANYWHERE      â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BASE_URL = `https://${STORAGE_ACCOUNT}.blob.core.windows.net/${CONTAINER}`;

let imageNames = [];

// PARTICLES
(function(){
  const w = document.getElementById('particles');
  const c = ['#1a9c45','#ff6b00','#ffd000','#0d6e2f','#ff9500'];
  for(let i=0;i<25;i++){
    const p = document.createElement('div');
    p.className = 'particle';
    const s = Math.random()*6+2;
    p.style.cssText=`left:${Math.random()*100}%;width:${s}px;height:${s}px;background:${c[Math.floor(Math.random()*c.length)]};animation-duration:${Math.random()*15+10}s;animation-delay:${Math.random()*10}s;`;
    w.appendChild(p);
  }
})();

// TOAST
function showToast(msg, type='success'){
  const icons={success:'âœ…',error:'âŒ',info:'â¬†ï¸'};
  const t=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  document.getElementById('toastIcon').textContent=icons[type]||'âœ…';
  t.className=`toast ${type} show`;
  setTimeout(()=>{t.className=`toast ${type}`;},3500);
}

// DRAG & DROP
function handleDragOver(e){e.preventDefault();document.getElementById('dropZone').classList.add('drag-over');}
function handleDragLeave(e){document.getElementById('dropZone').classList.remove('drag-over');}
function handleDrop(e){e.preventDefault();document.getElementById('dropZone').classList.remove('drag-over');uploadFiles(e.dataTransfer.files);}

// LIGHTBOX
function openLightbox(src){document.getElementById('lightboxImg').src=src;document.getElementById('lightbox').classList.add('open');}
function closeLightbox(){document.getElementById('lightbox').classList.remove('open');}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeLightbox();});

// LIST IMAGES
async function listImages(){
  const tbody=document.getElementById('imageList');
  try{
    const res=await fetch(`${BASE_URL}?restype=container&comp=list&${SAS_TOKEN}`);
    if(!res.ok) throw new Error(`Azure error ${res.status} â€” check SAS token and CORS settings`);
    const xml=new DOMParser().parseFromString(await res.text(),'application/xml');
    imageNames=Array.from(xml.getElementsByTagName('Blob')).map(b=>b.getElementsByTagName('Name')[0].textContent);
    const valid=imageNames.filter(n=>n!=='logo.jpg'&&n!=='logo.png');
    document.getElementById('statCount').textContent=valid.length;
    renderTable(imageNames);
  }catch(err){
    tbody.innerHTML=`<tr><td colspan="4"><div class="empty-state"><span class="empty-icon">âš ï¸</span><div class="empty-title">Connection Failed</div><div class="empty-sub">${err.message}</div></div></td></tr>`;
    document.getElementById('tableCount').textContent='Error';
  }
}

// RENDER TABLE â€” ALL HTTPS, SPACES ENCODED
function renderTable(list){
  const tbody=document.getElementById('imageList');
  const clean=list.filter(n=>n!=='logo.jpg'&&n!=='logo.png');
  document.getElementById('tableCount').textContent=`${clean.length} images`;

  if(!clean.length){
    tbody.innerHTML=`<tr><td colspan="4"><div class="empty-state"><span class="empty-icon">ğŸ–¼ï¸</span><div class="empty-title">No images yet</div><div class="empty-sub">Upload your first image above</div></div></td></tr>`;
    return;
  }

  tbody.innerHTML=clean.map((name,i)=>{
    const encoded    = encodeURIComponent(name);
    const previewUrl = `${BASE_URL}/${encoded}?${SAS_TOKEN}`;  // with SAS for display
    const publicUrl  = `${BASE_URL}/${encoded}`;               // clean HTTPS for sharing
    return `<tr style="animation-delay:${i*0.04}s">
      <td class="num-cell">${i+1}</td>
      <td class="preview-cell"><img class="img-thumb" src="${previewUrl}" loading="lazy" onclick="openLightbox('${previewUrl}')" title="Click to zoom"></td>
      <td>
        <div class="file-name">${name}</div>
        <div class="file-url">${publicUrl}</div>
      </td>
      <td>
        <div class="action-cell">
          <a class="view-link" href="${previewUrl}" target="_blank">ğŸ‘ View</a>
          <button class="btn btn-ghost" onclick="copyLink('${publicUrl}')">ğŸ“‹ Copy</button>
          <button class="del-btn" onclick="deleteImage('${encoded}')" title="Delete">âœ•</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

// SEARCH
function filterImages(){
  const q=document.getElementById('searchInput').value.toLowerCase();
  renderTable(imageNames.filter(n=>n.toLowerCase().includes(q)));
}

// COPY â€” HTTPS only
async function copyLink(url){
  try{await navigator.clipboard.writeText(url);showToast('HTTPS link copied!');}
  catch{showToast('Copy failed','error');}
}

// UPLOAD
document.getElementById('fileInput').addEventListener('change',e=>{uploadFiles(e.target.files);e.target.value='';});

async function uploadFiles(files){
  if(!files.length)return;
  const pw=document.getElementById('progressWrap');
  const pf=document.getElementById('progressFill');
  const pl=document.getElementById('progressLabel');
  const pp=document.getElementById('progressPct');
  pw.style.display='block';
  let done=0;

  for(const file of files){
    pl.textContent=`Uploading: ${file.name}`;
    try{
      const res=await fetch(`${BASE_URL}/${encodeURIComponent(file.name)}?${SAS_TOKEN}`,{
        method:'PUT',
        headers:{'x-ms-blob-type':'BlockBlob','Content-Type':file.type||'application/octet-stream'},
        body:file
      });
      if(!res.ok) throw new Error(res.status);
    }catch(e){showToast(`Failed: ${file.name}`,'error');console.error(e);}
    done++;
    const pct=Math.round((done/files.length)*100);
    pf.style.width=pct+'%';
    pp.textContent=pct+'%';
  }
  setTimeout(()=>{pw.style.display='none';pf.style.width='0%';},800);
  showToast(`âœ¨ ${files.length} image${files.length>1?'s':''} uploaded!`);
  listImages();
}

// DELETE ONE
async function deleteImage(encoded){
  if(!confirm('Delete this image?'))return;
  try{
    const res=await fetch(`${BASE_URL}/${encoded}?${SAS_TOKEN}`,{method:'DELETE'});
    if(!res.ok)throw new Error(res.status);
    showToast('Image deleted');
    listImages();
  }catch(e){showToast('Delete failed','error');}
}

// DELETE ALL
async function deleteAllImages(){
  const valid=imageNames.filter(n=>n!=='logo.jpg'&&n!=='logo.png');
  if(!valid.length){showToast('No images to delete','info');return;}
  if(prompt('âš ï¸ Type DELETE to confirm removing ALL images:')!=='DELETE')return;
  showToast('Deleting library...','info');
  for(const name of valid){
    await fetch(`${BASE_URL}/${encodeURIComponent(name)}?${SAS_TOKEN}`,{method:'DELETE'});
  }
  showToast('Library cleared');
  listImages();
}

// EXPORT â€” ALL HTTPS, SPACES ENCODED
function exportData(type){
  const valid=imageNames.filter(n=>n!=='logo.jpg'&&n!=='logo.png');
  if(!valid.length){showToast('No images to export','info');return;}
  let content='';
  if(type==='txt'){
    content=valid.map(n=>`${BASE_URL}/${encodeURIComponent(n)}`).join('\n');
  }else if(type==='csv'){
    content='Name,URL\n'+valid.map(n=>`"${n}","${BASE_URL}/${encodeURIComponent(n)}"`).join('\n');
  }else if(type==='sql'){
    content=valid.map(n=>`INSERT INTO images (name, url) VALUES ('${n.replace(/'/g,"\\'")}', '${BASE_URL}/${encodeURIComponent(n)}');`).join('\n');
  }
  const a=Object.assign(document.createElement('a'),{
    href:URL.createObjectURL(new Blob([content],{type:'text/plain'})),
    download:`hp-images.${type}`
  });
  a.click();
  showToast(`${type.toUpperCase()} exported!`);
}

// START
listImages();
</script>
</body>
</html>
