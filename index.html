<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Healthy Planet ¬∑ Image Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #0d6e2f;
    --green2: #1a9c45;
    --orange: #ff6b00;
    --orange2: #ff9500;
    --yellow: #ffd000;
    --red: #ff2d55;
    --bg: #0a0f0a;
    --card: #111811;
    --card2: #162016;
    --border: rgba(255,255,255,0.07);
    --text: #f0f8f0;
    --muted: #7a9a7a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ANIMATED BG */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 10% 10%, rgba(13,110,47,0.25) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 90% 80%, rgba(255,107,0,0.15) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 50% 50%, rgba(255,208,0,0.04) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
    animation: bgPulse 8s ease-in-out infinite alternate;
  }

  @keyframes bgPulse {
    0% { opacity: 0.6; }
    100% { opacity: 1; }
  }

  /* FLOATING PARTICLES */
  .particles {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }

  .particle {
    position: absolute;
    border-radius: 50%;
    animation: float linear infinite;
    opacity: 0;
  }

  @keyframes float {
    0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(-10vh) rotate(720deg); opacity: 0; }
  }

  /* HEADER */
  header {
    position: relative;
    z-index: 10;
    padding: 0 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 80px;
    border-bottom: 1px solid var(--border);
    background: rgba(10,15,10,0.8);
    backdrop-filter: blur(20px);
    animation: slideDown 0.6s ease both;
  }

  @keyframes slideDown {
    from { transform: translateY(-80px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-badge {
    width: 46px;
    height: 46px;
    background: linear-gradient(135deg, var(--green), var(--green2));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 0 20px rgba(26,156,69,0.4);
    animation: pulse 3s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 20px rgba(26,156,69,0.4); }
    50% { box-shadow: 0 0 40px rgba(26,156,69,0.7), 0 0 80px rgba(26,156,69,0.2); }
  }

  .logo-text {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 3px;
    background: linear-gradient(90deg, var(--green2), var(--yellow));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .logo-sub {
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-top: -4px;
  }

  .header-badge {
    background: linear-gradient(135deg, var(--orange), var(--orange2));
    padding: 6px 16px;
    border-radius: 100px;
    font-size: 11px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    animation: badgePop 0.6s 0.4s ease both;
  }

  @keyframes badgePop {
    from { transform: scale(0); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  /* HERO SECTION */
  .hero {
    position: relative;
    z-index: 10;
    padding: 50px 40px 30px;
    animation: fadeUp 0.7s 0.2s ease both;
  }

  @keyframes fadeUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .hero h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3rem, 7vw, 6rem);
    line-height: 0.95;
    letter-spacing: 2px;
  }

  .hero h1 span.g { color: var(--green2); }
  .hero h1 span.o {
    background: linear-gradient(90deg, var(--orange), var(--yellow));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-sub {
    margin-top: 14px;
    color: var(--muted);
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 3px;
  }

  /* STATS BAR */
  .stats-bar {
    position: relative;
    z-index: 10;
    display: flex;
    gap: 20px;
    padding: 0 40px 30px;
    animation: fadeUp 0.7s 0.3s ease both;
    flex-wrap: wrap;
  }

  .stat {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: transform 0.3s, border-color 0.3s;
  }

  .stat:hover {
    transform: translateY(-3px);
    border-color: rgba(26,156,69,0.3);
  }

  .stat-icon { font-size: 24px; }

  .stat-val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    color: var(--green2);
    line-height: 1;
  }

  .stat-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
  }

  /* MAIN CONTENT */
  .main {
    position: relative;
    z-index: 10;
    padding: 0 40px 60px;
    animation: fadeUp 0.7s 0.4s ease both;
  }

  /* DROP ZONE */
  .drop-zone {
    border: 2px dashed rgba(26,156,69,0.4);
    border-radius: 24px;
    padding: 50px;
    text-align: center;
    background: var(--card);
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
  }

  .drop-zone::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(26,156,69,0.05) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
  }

  .drop-zone:hover::before,
  .drop-zone.drag-over::before { opacity: 1; }

  .drop-zone:hover,
  .drop-zone.drag-over {
    border-color: var(--green2);
    transform: scale(1.01);
    box-shadow: 0 0 60px rgba(26,156,69,0.1), inset 0 0 60px rgba(26,156,69,0.03);
  }

  .drop-icon {
    font-size: 3.5rem;
    margin-bottom: 16px;
    display: block;
    animation: bounce 2s ease-in-out infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .drop-title {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 6px;
  }

  .drop-sub {
    color: var(--muted);
    font-size: 13px;
    font-weight: 600;
  }

  .upload-btn-wrap {
    margin-top: 20px;
  }

  /* CONTROLS */
  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 24px;
    flex-wrap: wrap;
    align-items: center;
  }

  .search-wrap {
    flex: 1;
    min-width: 220px;
    position: relative;
  }

  .search-wrap::before {
    content: 'üîç';
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 14px;
    pointer-events: none;
  }

  .search-box {
    width: 100%;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 12px 20px 12px 44px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 14px;
    font-weight: 600;
    outline: none;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  .search-box:focus {
    border-color: rgba(26,156,69,0.5);
    box-shadow: 0 0 0 3px rgba(26,156,69,0.1);
  }

  .search-box::placeholder { color: var(--muted); }

  /* BUTTONS */
  .btn {
    border: none;
    padding: 11px 22px;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: 12px;
    border-radius: 100px;
    cursor: pointer;
    transition: all 0.25s;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
  }

  .btn::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0);
    transition: background 0.2s;
  }

  .btn:hover::after { background: rgba(255,255,255,0.1); }
  .btn:active { transform: scale(0.96); }

  .btn-green {
    background: linear-gradient(135deg, var(--green), var(--green2));
    color: white;
    box-shadow: 0 4px 20px rgba(26,156,69,0.3);
  }

  .btn-green:hover { box-shadow: 0 6px 30px rgba(26,156,69,0.5); transform: translateY(-2px); }

  .btn-orange {
    background: linear-gradient(135deg, var(--orange), var(--orange2));
    color: white;
    box-shadow: 0 4px 20px rgba(255,107,0,0.3);
  }

  .btn-orange:hover { box-shadow: 0 6px 30px rgba(255,107,0,0.5); transform: translateY(-2px); }

  .btn-yellow {
    background: linear-gradient(135deg, #b8860b, var(--yellow));
    color: #0a0f0a;
    box-shadow: 0 4px 20px rgba(255,208,0,0.2);
  }

  .btn-yellow:hover { box-shadow: 0 6px 30px rgba(255,208,0,0.4); transform: translateY(-2px); }

  .btn-red {
    background: linear-gradient(135deg, #c0392b, var(--red));
    color: white;
    box-shadow: 0 4px 20px rgba(255,45,85,0.3);
    margin-left: auto;
  }

  .btn-red:hover { box-shadow: 0 6px 30px rgba(255,45,85,0.5); transform: translateY(-2px); }

  .btn-ghost {
    background: var(--card2);
    border: 1px solid var(--border);
    color: var(--text);
    font-size: 11px;
    padding: 6px 14px;
    border-radius: 8px;
  }

  .btn-ghost:hover { border-color: var(--green2); color: var(--green2); }

  input[type="file"] { display: none; }

  /* TABLE */
  .table-wrap {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    overflow: hidden;
  }

  .table-header {
    padding: 20px 28px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--card2);
  }

  .table-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
    color: var(--green2);
  }

  .table-count {
    background: rgba(26,156,69,0.15);
    border: 1px solid rgba(26,156,69,0.3);
    color: var(--green2);
    padding: 4px 14px;
    border-radius: 100px;
    font-size: 12px;
    font-weight: 800;
  }

  table { width: 100%; border-collapse: collapse; }

  thead th {
    padding: 14px 20px;
    text-align: left;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--muted);
    font-weight: 800;
    background: rgba(255,255,255,0.02);
    border-bottom: 1px solid var(--border);
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background 0.2s;
    animation: rowIn 0.4s ease both;
  }

  @keyframes rowIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  tbody tr:hover { background: rgba(26,156,69,0.04); }
  tbody tr:last-child { border-bottom: none; }

  td {
    padding: 14px 20px;
    font-size: 13px;
    color: var(--text);
    vertical-align: middle;
  }

  .num-cell {
    color: var(--muted);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    width: 50px;
  }

  .preview-cell { width: 80px; }

  .img-thumb {
    width: 56px;
    height: 56px;
    object-fit: contain;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--card2);
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: zoom-in;
  }

  .img-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
  }

  .file-name {
    font-weight: 700;
    margin-bottom: 4px;
    color: var(--text);
    word-break: break-all;
  }

  .file-url {
    font-size: 11px;
    color: var(--muted);
    word-break: break-all;
    font-family: monospace;
  }

  .action-cell {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  .view-link {
    color: var(--orange);
    font-weight: 800;
    font-size: 12px;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: color 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .view-link:hover { color: var(--orange2); }

  .del-btn {
    background: rgba(255,45,85,0.1);
    border: 1px solid rgba(255,45,85,0.2);
    color: var(--red);
    width: 32px;
    height: 32px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .del-btn:hover {
    background: rgba(255,45,85,0.25);
    transform: scale(1.1);
  }

  .empty-state {
    padding: 80px 20px;
    text-align: center;
    color: var(--muted);
  }

  .empty-icon { font-size: 4rem; margin-bottom: 16px; display: block; }
  .empty-title { font-size: 1.1rem; font-weight: 800; color: var(--text); margin-bottom: 8px; }
  .empty-sub { font-size: 13px; }

  /* LOADING */
  .loading-state {
    padding: 80px 20px;
    text-align: center;
    color: var(--muted);
  }

  .spinner {
    width: 48px;
    height: 48px;
    border: 3px solid var(--border);
    border-top-color: var(--green2);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* PROGRESS BAR */
  .progress-wrap {
    display: none;
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 999;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 16px 24px;
    min-width: 300px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateX(-50%) translateY(20px); opacity: 0; }
    to { transform: translateX(-50%) translateY(0); opacity: 1; }
  }

  .progress-label {
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
  }

  .progress-bar {
    height: 6px;
    background: var(--border);
    border-radius: 100px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--green), var(--green2));
    border-radius: 100px;
    transition: width 0.3s;
    width: 0%;
  }

  /* TOAST */
  .toast {
    position: fixed;
    top: 100px;
    right: 30px;
    z-index: 9999;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px 22px;
    font-size: 14px;
    font-weight: 700;
    box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    transform: translateX(200px);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    gap: 10px;
    max-width: 320px;
  }

  .toast.show {
    transform: translateX(0);
    opacity: 1;
  }

  .toast.success { border-left: 4px solid var(--green2); }
  .toast.error { border-left: 4px solid var(--red); }
  .toast.info { border-left: 4px solid var(--orange); }

  /* LIGHTBOX */
  .lightbox {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    animation: fadeIn 0.2s ease;
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .lightbox.open { display: flex; }

  .lightbox img {
    max-width: 90vw;
    max-height: 85vh;
    object-fit: contain;
    border-radius: 16px;
    box-shadow: 0 40px 100px rgba(0,0,0,0.6);
    animation: zoomIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  @keyframes zoomIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .lightbox-close {
    position: absolute;
    top: 24px;
    right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    background: rgba(255,255,255,0.1);
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    line-height: 1;
  }

  .lightbox-close:hover { background: rgba(255,255,255,0.2); }

  /* FOOTER */
  footer {
    position: relative;
    z-index: 10;
    text-align: center;
    padding: 30px;
    color: var(--muted);
    font-size: 12px;
    font-weight: 600;
    border-top: 1px solid var(--border);
  }

  footer span { color: var(--green2); }

  /* RESPONSIVE */
  @media (max-width: 600px) {
    header { padding: 0 20px; }
    .hero, .stats-bar, .main { padding-left: 20px; padding-right: 20px; }
    .drop-zone { padding: 30px 20px; }
    .controls { gap: 8px; }
    .btn { padding: 9px 16px; font-size: 11px; }
  }
</style>
</head>
<body>

<!-- PARTICLES -->
<div class="particles" id="particles"></div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
  <img id="lightboxImg" src="" alt="">
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span id="toastIcon">‚úÖ</span>
  <span id="toastMsg">Done!</span>
</div>

<!-- PROGRESS -->
<div class="progress-wrap" id="progressWrap">
  <div class="progress-label">
    <span id="progressLabel">Uploading...</span>
    <span id="progressPct">0%</span>
  </div>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
</div>

<!-- HEADER -->
<header>
  <div class="logo-area">
    <div class="logo-badge">üåø</div>
    <div>
      <div class="logo-text">Healthy Planet</div>
      <div class="logo-sub">Image Manager</div>
    </div>
  </div>
  <div class="header-badge">üá®üá¶ Canada</div>
</header>

<!-- HERO -->
<div class="hero">
  <h1><span class="g">IMAGE</span><br><span class="o">LIBRARY</span></h1>
  <div class="hero-sub">Marketing Department ¬∑ Healthy Planet Canada</div>
</div>

<!-- STATS -->
<div class="stats-bar">
  <div class="stat">
    <div class="stat-icon">üñºÔ∏è</div>
    <div>
      <div class="stat-val" id="statCount">‚Äî</div>
      <div class="stat-label">Total Images</div>
    </div>
  </div>
  <div class="stat">
    <div class="stat-icon">‚òÅÔ∏è</div>
    <div>
      <div class="stat-val">Azure</div>
      <div class="stat-label">Blob Storage</div>
    </div>
  </div>
  <div class="stat">
    <div class="stat-icon">üîí</div>
    <div>
      <div class="stat-val">SAS</div>
      <div class="stat-label">Secured Access</div>
    </div>
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- DROP ZONE -->
  <div class="drop-zone" id="dropZone"
       onclick="document.getElementById('fileInput').click()"
       ondragover="handleDragOver(event)"
       ondragleave="handleDragLeave(event)"
       ondrop="handleDrop(event)">
    <span class="drop-icon">‚òÅÔ∏è</span>
    <div class="drop-title">Drop images here or click to upload</div>
    <div class="drop-sub">Supports JPG, PNG, GIF, WEBP, SVG ‚Äî any size</div>
    <div class="upload-btn-wrap">
      <button class="btn btn-green" onclick="event.stopPropagation(); document.getElementById('fileInput').click()">
        ‚¨ÜÔ∏è Choose Files
      </button>
    </div>
    <input type="file" id="fileInput" multiple accept="image/*">
  </div>

  <!-- CONTROLS -->
  <div class="controls">
    <div class="search-wrap">
      <input class="search-box" id="searchInput" type="text" placeholder="Search images..." onkeyup="filterImages()">
    </div>
    <button class="btn btn-green" onclick="exportData('txt')">üìÑ TXT</button>
    <button class="btn btn-orange" onclick="exportData('csv')">üìä CSV</button>
    <button class="btn btn-yellow" onclick="exportData('sql')">üóÑÔ∏è SQL</button>
    <button class="btn btn-orange" onclick="window.print()">üñ®Ô∏è Print</button>
    <button class="btn btn-red" onclick="deleteAllImages()">üóëÔ∏è Delete All</button>
  </div>

  <!-- TABLE -->
  <div class="table-wrap">
    <div class="table-header">
      <div class="table-title">üìÅ Image Library</div>
      <div class="table-count" id="tableCount">Loading...</div>
    </div>
    <table id="mainTable">
      <thead>
        <tr>
          <th class="num-cell">#</th>
          <th>Preview</th>
          <th>File Name & URL</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="imageList">
        <tr>
          <td colspan="4">
            <div class="loading-state">
              <div class="spinner"></div>
              <div>Connecting to Azure Blob Storage...</div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<footer>¬© 2026 <span>Healthy Planet Canada</span> ¬∑ Marketing Image Manager ¬∑ Built with ‚ù§Ô∏è</footer>

<script>
const STORAGE_ACCOUNT = "hpcanadanavimages";
const CONTAINER = "images";
const SAS_TOKEN = "se=2030-12-31se=2030-12-31T23%3A59%3A59Z&sp=rcwdl&sv=2022-11-02&sr=c&sig=DJftKogfIbf8IXhINUjm8rW4tY%2BL0/Z476w2Hj4SRDg%3Dsp=rcwdlse=2030-12-31T23%3A59%3A59Z&sp=rcwdl&sv=2022-11-02&sr=c&sig=DJftKogfIbf8IXhINUjm8rW4tY%2BL0/Z476w2Hj4SRDg%3Dsv=2026-02-06se=2030-12-31T23%3A59%3A59Z&sp=rcwdl&sv=2022-11-02&sr=c&sig=DJftKogfIbf8IXhINUjm8rW4tY%2BL0/Z476w2Hj4SRDg%3Dsr=cse=2030-12-31T23%3A59%3A59Z&sp=rcwdl&sv=2022-11-02&sr=c&sig=DJftKogfIbf8IXhINUjm8rW4tY%2BL0/Z476w2Hj4SRDg%3Dsig=2RgStLPU%2BVPFkLsGZHTBEsvXVbTkF955I/aLwIl/1dM%3D";
const BASE_URL = `https://${STORAGE_ACCOUNT}.blob.core.windows.net/${CONTAINER}`;
const HTTP_BASE = `http://${STORAGE_ACCOUNT}.blob.core.windows.net/${CONTAINER}`;

let imageNames = [];

// ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function spawnParticles() {
  const container = document.getElementById('particles');
  const colors = ['#1a9c45','#ff6b00','#ffd000','#0d6e2f','#ff9500'];
  for (let i = 0; i < 25; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random() * 6 + 2;
    p.style.cssText = `
      left: ${Math.random() * 100}%;
      width: ${size}px; height: ${size}px;
      background: ${colors[Math.floor(Math.random() * colors.length)]};
      animation-duration: ${Math.random() * 15 + 10}s;
      animation-delay: ${Math.random() * 10}s;
      opacity: 0;
    `;
    container.appendChild(p);
  }
})();

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg, type = 'success') {
  const icons = { success: '‚úÖ', error: '‚ùå', info: '‚¨ÜÔ∏è' };
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  document.getElementById('toastIcon').textContent = icons[type] || '‚úÖ';
  t.className = `toast ${type} show`;
  setTimeout(() => { t.className = `toast ${type}`; }, 3500);
}

// ‚îÄ‚îÄ DRAG & DROP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleDragOver(e) {
  e.preventDefault();
  document.getElementById('dropZone').classList.add('drag-over');
}
function handleDragLeave(e) {
  document.getElementById('dropZone').classList.remove('drag-over');
}
function handleDrop(e) {
  e.preventDefault();
  document.getElementById('dropZone').classList.remove('drag-over');
  uploadFiles(e.dataTransfer.files);
}

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openLightbox(src) {
  document.getElementById('lightboxImg').src = src;
  document.getElementById('lightbox').classList.add('open');
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

// ‚îÄ‚îÄ LIST IMAGES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function listImages() {
  const tbody = document.getElementById('imageList');
  try {
    const url = `${BASE_URL}?restype=container&comp=list&${SAS_TOKEN}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Azure error ' + res.status);
    const xml = new DOMParser().parseFromString(await res.text(), 'application/xml');
    imageNames = Array.from(xml.getElementsByTagName('Blob'))
      .map(b => b.getElementsByTagName('Name')[0].textContent);
    renderTable(imageNames);
    document.getElementById('statCount').textContent = imageNames.filter(n => n !== 'logo.jpg' && n !== 'logo.png').length;
  } catch (err) {
    tbody.innerHTML = `<tr><td colspan="4">
      <div class="empty-state">
        <span class="empty-icon">‚ö†Ô∏è</span>
        <div class="empty-title">Connection Failed</div>
        <div class="empty-sub">${err.message}</div>
      </div>
    </td></tr>`;
    document.getElementById('tableCount').textContent = 'Error';
  }
}

// ‚îÄ‚îÄ RENDER TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTable(list) {
  const tbody = document.getElementById('imageList');
  const clean = list.filter(n => n !== 'logo.jpg' && n !== 'logo.png');
  document.getElementById('tableCount').textContent = `${clean.length} images`;

  if (!clean.length) {
    tbody.innerHTML = `<tr><td colspan="4">
      <div class="empty-state">
        <span class="empty-icon">üñºÔ∏è</span>
        <div class="empty-title">No images yet</div>
        <div class="empty-sub">Upload your first image using the drop zone above</div>
      </div>
    </td></tr>`;
    return;
  }

  tbody.innerHTML = clean.map((name, i) => {
    const previewUrl = `${BASE_URL}/${encodeURIComponent(name)}?${SAS_TOKEN}`;
    const copyUrl = `${HTTP_BASE}/${encodeURIComponent(name)}`;
    return `<tr style="animation-delay:${i * 0.04}s">
      <td class="num-cell">${i + 1}</td>
      <td class="preview-cell">
        <img class="img-thumb" src="${previewUrl}" loading="lazy"
             onclick="openLightbox('${previewUrl}')" title="Click to zoom">
      </td>
      <td>
        <div class="file-name">${name}</div>
        <div class="file-url">${copyUrl}</div>
      </td>
      <td>
        <div class="action-cell">
          <a class="view-link" href="${previewUrl}" target="_blank">üëÅ View</a>
          <button class="btn btn-ghost" onclick="copyLink('${copyUrl}')">üìã Copy</button>
          <button class="del-btn" onclick="deleteImage('${encodeURIComponent(name)}')" title="Delete">‚úï</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

// ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterImages() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  renderTable(imageNames.filter(n => n.toLowerCase().includes(q)));
}

// ‚îÄ‚îÄ COPY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function copyLink(url) {
  try {
    await navigator.clipboard.writeText(url);
    showToast('Link copied to clipboard!');
  } catch { showToast('Copy failed', 'error'); }
}

// ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('fileInput').addEventListener('change', e => {
  uploadFiles(e.target.files);
  e.target.value = '';
});

async function uploadFiles(files) {
  if (!files.length) return;
  const pw = document.getElementById('progressWrap');
  const pf = document.getElementById('progressFill');
  const pl = document.getElementById('progressLabel');
  const pp = document.getElementById('progressPct');
  pw.style.display = 'block';

  let done = 0;
  for (const file of files) {
    pl.textContent = `Uploading: ${file.name}`;
    const url = `${BASE_URL}/${encodeURIComponent(file.name)}?${SAS_TOKEN}`;
    try {
      await fetch(url, {
        method: 'PUT',
        headers: { 'x-ms-blob-type': 'BlockBlob', 'Content-Type': file.type },
        body: file
      });
    } catch (e) { console.error(e); }
    done++;
    const pct = Math.round((done / files.length) * 100);
    pf.style.width = pct + '%';
    pp.textContent = pct + '%';
  }

  setTimeout(() => { pw.style.display = 'none'; pf.style.width = '0%'; }, 800);
  showToast(`‚ú® ${files.length} image${files.length > 1 ? 's' : ''} uploaded!`);
  listImages();
}

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function deleteImage(name) {
  if (!confirm('Delete this image?')) return;
  try {
    await fetch(`${BASE_URL}/${name}?${SAS_TOKEN}`, { method: 'DELETE' });
    showToast('Image deleted');
    listImages();
  } catch { showToast('Delete failed', 'error'); }
}

async function deleteAllImages() {
  const valid = imageNames.filter(n => n !== 'logo.jpg' && n !== 'logo.png');
  if (!valid.length) return;
  if (prompt('‚ö†Ô∏è Type DELETE to confirm removing ALL images:') !== 'DELETE') return;
  showToast('Deleting library...', 'info');
  for (const name of valid) {
    await fetch(`${BASE_URL}/${encodeURIComponent(name)}?${SAS_TOKEN}`, { method: 'DELETE' });
  }
  showToast('Library cleared');
  listImages();
}

// ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportData(type) {
  const valid = imageNames.filter(n => n !== 'logo.jpg' && n !== 'logo.png');
  let content = '', ext = type;
  if (type === 'txt') content = valid.map(n => `${HTTP_BASE}/${n}`).join('\n');
  else if (type === 'csv') content = 'Name,URL\n' + valid.map(n => `${n},${HTTP_BASE}/${n}`).join('\n');
  else if (type === 'sql') {
    content = valid.map(n => `INSERT INTO images (name, url) VALUES ('${n}', '${HTTP_BASE}/${n}');`).join('\n');
  }
  const a = Object.assign(document.createElement('a'), {
    href: URL.createObjectURL(new Blob([content], { type: 'text/plain' })),
    download: `hp-images.${ext}`
  });
  a.click();
  showToast(`${type.toUpperCase()} exported!`);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
listImages();
</script>
</body>
</html>
